<div class="page-wrapper">
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header invoices-page-header">
            <div class="row align-items-center">
                <div class="col">
                    <ul class="breadcrumb invoices-breadcrumb">
                        <li class="breadcrumb-item invoices-breadcrumb-item">
                            <a [routerLink]="routes.allInvoice">
                                <i class="fa fa-chevron-left"></i> Menu Principal
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /Page Header -->
        <form [formGroup]="frm_venta">
            <div class="row">
                <div class="col-md-12">
                    <div class="card invoices-add-card">
                        <div class="card-body">
                            <section action="#" class="invoices-form">
                                <div class="invoices-main-form">
                                    <div class="row">
                                        <div class="col-xl-4 col-md-6 col-sm-12 col-12">
                                            <div class="form-group mt-4">
                                                <div class="col-12 col-md-6 col-xl-12">
                                                    <div class="form-group local-forms">
                                                        <label for="Purchased">Proveedor</label>
                                                        <mat-select formControlName="proveedor" name="proveedor"
                                                            class="form-control select"
                                                            placeholder="Seleccione un Proveedor.." name="proveedor">
                                                            <mat-option *ngFor="let item of dataproveedor"
                                                                [value]="item.prve_id">
                                                                <!-- {{ item['prve_nombre'] }} -->
                                                                {{ item.prve_nombre }}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error
                                                            *ngIf="frm_venta.get('proveedor').hasError('required')">
                                                            Debe seleccionar un proveedor
                                                        </mat-error>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="invoice-item">
                                    <div class="row">
                                        <div class="col-12 col-md-6 col-xl-4">
                                            <div class="form-group local-forms">
                                                <label for="Purchased">Categoria</label>
                                                <mat-select formControlName="categoria" name="categoria"
                                                    class="form-control select" placeholder="Seleccione un Proveedor.."
                                                    name="categoria" (selectionChange)="changesubcat($event.value)">
                                                    <mat-option *ngFor="let item of datacategoria"
                                                        [value]="item.cat_id">
                                                        <!-- {{ item['prve_nombre'] }} -->
                                                        {{ item.cat_nombre }}
                                                    </mat-option>
                                                </mat-select>
                                                <mat-error *ngIf="frm_venta.get('categoria').hasError('required')">
                                                    Debe seleccionar un categoria
                                                </mat-error>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6 col-xl-4">
                                            <div class="form-group local-forms">
                                                <div class="form-group local-forms">
                                                    <label for="Purchased">Sub Categoria</label>
                                                    <mat-select formControlName="subcategoria" name="subcategoria" 
                                                        (selectionChange)="changeproducto($event.value)"
                                                        class="form-control select"
                                                        placeholder="Seleccione un SubCategoria..">
                                                        <mat-option *ngFor="let item of datasubcategoria"
                                                            [value]="item.sbc_id">
                                                            {{ item.sbc_nombre }}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error *ngIf="frm_venta.get('subcategoria').hasError('required')">
                                                        Debe seleccionar un subcategoria
                                                    </mat-error>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6 col-xl-4">
                                            <div class="form-group local-forms">
                                                <div class="form-group local-forms">
                                                    <label for="Purchased">Producto</label>
                                                    <mat-select formControlName="producto" name="producto"
                                                        class="form-control select"
                                                        placeholder="Seleccione un Producto..">
                                                        <mat-option *ngFor="let item of dataproducto"
                                                            [value]="item.pro_id">
                                                            {{ item.pro_detalle }}
                                                        </mat-option>
                                                    </mat-select>
                                                    <mat-error *ngIf="frm_venta.get('producto').hasError('required')">
                                                        Debe seleccionar un producto
                                                    </mat-error>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="invoice-add-table">
                                    <h4>Detalles</h4>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-nowrap  mb-0 no-footer add-table-items"
                                            formArrayName="details">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">NoÂº.</th>
                                                    <th>Nombre Producto</th>
                                                    <th>Costo Unitario</th>
                                                    <th>Cantidad</th>
                                                    <th>Total</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="add-row"
                                                    *ngFor="let item of  invproducts.controls;let i = index"
                                                    [formGroupName]="i">
                                                    <td class="text-center">{{i+1}}</td>
                                                    <td>
                                                        <input type="text" name="nombreproducto" formControlName="nombreproducto"
                                                            class="form-control">
                                                    </td>
                                                    <td>
                                                        <input type="text" name="costounitario" formControlName="costounitario"
                                                            class="form-control" (change)="Itemcalculation(i)">
                                                    </td>
                                                    <td>
                                                        <input type="text" name="cantidad" formControlName="cantidad"
                                                            class="form-control" (change)="Itemcalculation(i)">
                                                    </td>
                                                    <td>
                                                        <input class="form-control" formControlName="total" />
                                                    </td>
                                                    <td class="add-remove text-end">
                                                        <a href="javascript:void(0);" class="add-btns me-2"
                                                            (click)="addItem()"><i class="fas fa-plus-circle"></i></a>
                                                        <!-- <a href="javascript:void(0);" class="copy-btn me-2"><i class="fas fa-copy"></i></a> -->
                                                        <a href="javascript:void(0);" class="remove-btn"><i
                                                                class="fa fa-trash-alt" (click)="deleteItem(i)"
                                                                (keyup.enter)="deleteItem(i)" tabindex="1"></i></a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td colspan="6">
                                                        <button (click)="addcompra()" (keydown.enter)="addcompra()"
                                                            class="btn btn-success">[+]</button>
                                                    </td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-7 col-md-6">
                                        <div class="invoice-faq">
                                            <div class="panel-group" id="accordion" role="tablist"
                                                aria-multiselectable="true">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-5 col-md-6">
                                        <div class="invoice-total-card">
                                            <h4 class="invoice-total-title">Resumen Valores Compra</h4>
                                            <div class="invoice-total-box">
                                                <div class="invoice-total-inner">
                                                    <p>Sub Total($)</p>
                                                    <input style="text-align:right" type="text" name="total" formControlName="total" class="form-control border-0">
                                                    <p class="mt-2">Iva(15%)</p>
                                                    <input style="text-align:right" type="text" name="tax" formControlName="tax" class="form-control border-0">
                                                </div>
                                                <div class="invoice-total-footer">
                                                    <!-- <h4>Monto Total<span>$ 894.00</span></h4> -->
                                                     <label for="Purchased" class="fw-bold">Monto Total($)</label>
                                                    <input style="text-align:right" type="text" name="netTotal" formControlName="netTotal" class="form-control border-0 fw-bold">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="upload-sign">
                                            <div class="form-group float-end mb-0">
                                                <button class="btn btn-primary" type="submit" (click)="onSubmit()">Guardar Compra +</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Save Invoices Modal -->
<div class="modal custom-modal modal-bg fade" id="save_invocies_details" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-header">
                    <h3>Save Invoice Details</h3>
                    <p>Are you sure want to save?</p>
                </div>
                <div class="modal-btn delete-action">
                    <div class="row">
                        <div class="col-6">
                            <a href="javascript:void(0);" data-bs-dismiss="modal"
                                class="btn btn-primary paid-continue-btn">Save</a>
                        </div>
                        <div class="col-6">
                            <a href="javascript:void(0);" data-bs-dismiss="modal"
                                class="btn btn-primary paid-cancel-btn">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Save Invoices Modal -->